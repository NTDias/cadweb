{% extends 'base.html' %}

{% block titulo_conteudo %} Nota Fiscal Eletrônica {% endblock %}

{% block conteudo %}
<div class="container border p-4 bg-white">
    <div class="row border mb-2">
        <div class="col-md-4 border-end p-3 text-center">
            <h5>{{ pedido.cliente.nome }}</h5>
            <p class="small">CPF: {{ pedido.cliente.cpf }}</p>
        </div>
        <div class="col-md-4 border-end p-3 text-center">
            <strong>DANFE</strong><br>
            <small>Documento Auxiliar da Nota Fiscal Eletrônica</small>
        </div>
        <div class="col-md-4 p-3 text-center">
            <strong>Nº: {{ pedido.id|stringformat:"09d" }}</strong><br>
            <strong>SÉRIE: 001</strong>
        </div>
    </div>

    <div class="row border mb-3">
        <div class="col-12 p-2 text-center bg-light">
            <small class="d-block">CHAVE DE ACESSO</small>
            <span class="h6 font-monospace" style="letter-spacing: 2px;">{{ pedido.chave_acesso }}</span>
        </div>
    </div>

    <div class="row border mb-3">
        <div class="col-12 bg-secondary text-white p-1 ps-2"><small>DESTINATÁRIO / REMETENTE</small></div>
        <div class="col-md-8 p-2">
            <small class="text-muted d-block">NOME / RAZÃO SOCIAL</small>
            <span>{{ pedido.cliente.nome }}</span>
        </div>
        <div class="col-md-4 p-2">
            <small class="text-muted d-block">CPF / CNPJ</small>
            <span>{{ pedido.cliente.cpf }}</span>
        </div>
    </div>

    <div class="row">
        <table class="table table-bordered table-sm">
            <thead class="bg-light">
                <tr class="small">
                    <th>CÓDIGO</th>
                    <th>DESCRIÇÃO DO PRODUTO</th>
                    <th>QTD</th>
                    <th>VLR. UNIT</th>
                    <th>VLR. TOTAL</th>
                </tr>
            </thead>
            <tbody>
                {% for item in pedido.itempedido_set.all %}
                <tr>
                    <td>{{ item.produto.id }}</td>
                    <td>{{ item.produto.nome }}</td>
                    <td>{{ item.qtde }}</td>
                    <td>R$ {{ item.preco }}</td>
                    <td>R$ {{ item.total }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="row border mt-2">
        <div class="col-12 bg-secondary text-white p-1 ps-2"><small>CÁLCULO DO IMPOSTO</small></div>
        <div class="col-md-2 border-end p-1 text-center">
            <small class="text-muted d-block">VALOR ICMS (18%)</small>
            <strong>R$ {{ pedido.valor_icms|floatformat:2 }}</strong>
        </div>
        <div class="col-md-2 border-end p-1 text-center">
            <small class="text-muted d-block">VALOR IPI (4%)</small>
            <strong>R$ {{ pedido.valor_ipi|floatformat:2 }}</strong>
        </div>
        <div class="col-md-2 border-end p-1 text-center">
            <small class="text-muted d-block">VALOR PIS (1.65%)</small>
            <strong>R$ {{ pedido.valor_pis|floatformat:2 }}</strong>
        </div>
        <div class="col-md-3 border-end p-1 text-center">
            <small class="text-muted d-block">COFINS (7.6%)</small>
            <strong>R$ {{ pedido.valor_cofins|floatformat:2 }}</strong>
        </div>
        <div class="col-md-3 p-1 text-center">
            <small class="text-muted d-block">TOTAL DA NOTA</small>
            <strong>R$ {{ pedido.total_com_impostos|floatformat:2 }}</strong>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-8 border p-2 bg-light">
            <small class="d-block text-muted">INFORMAÇÕES COMPLEMENTARES</small>
            <p class="small mb-0">Emitido em: {{ pedido.data_pedidof }}</p>
            <p class="small mb-0 text-uppercase">Total Pago: R$ {{ pedido.total_pago }} | Débito Restante: R$ {{ pedido.debito }}</p>
        </div>
        <div class="col-md-4 text-end">
            <h5 class="mt-3">VALOR TOTAL: R$ {{ pedido.total_com_impostos|floatformat:2 }}</h5>
        </div>
    </div>

    <div class="text-center mt-5 no-print">
        <button onclick="window.print();" class="btn btn-dark shadow-sm">
            <i class="fas fa-print me-2"></i> Imprimir Nota Fiscal
        </button>
        <a href="{% url 'detalhes_pedido' pedido.id %}" class="btn btn-outline-secondary ms-2">
            Voltar ao Pedido
        </a>
    </div>
</div>

<style>
    @media print {
        .no-print { display: none !important; }
        .sidebar, .navbar, .card-header { display: none !important; }
        .content { margin-left: 0 !important; padding: 0 !important; }
        .container { width: 100% !important; max-width: none !important; border: none !important; }
    }
    .font-monospace { font-family: 'Courier New', Courier, monospace; }
</style>
{% endblock %}